mod events;
mod framing;
mod header;
mod incoming;
mod outgoing;

use crate::{Connection, ConnectionEvent};

pub(crate) use incoming::IncomingStream;
pub(crate) use outgoing::OutgoingStreamsState;

pub use events::StreamEvent;

impl Connection {
    /// Call when a new incoming stream is opened.
    pub fn stream_opened(&mut self, stream: RecvStreamId) {
        self.incoming_streams.insert(stream, IncomingStream::new());
    }

    /// Call when a stream is reset.
    pub fn stream_reset(&mut self, stream: RecvStreamId) {
        self.incoming_streams.remove(&stream);
    }

    /// Call when a stream is finished.
    pub fn stream_finished(&mut self, stream: RecvStreamId) {
        self.incoming_streams.remove(&stream);
    }

    /// Call when a stream is stopped.
    pub fn stream_stopped(&mut self, stream: SendStreamId) {
        todo!()
    }

    fn stream_event(&mut self, event: StreamEvent) {
        self.events.push(ConnectionEvent::StreamEvent(event));
    }
}

/// A stream identifier for an **outgoing** (sending) QUIC stream.
/// 
/// Generated by the state machine.
#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]
pub struct SendStreamId(pub u64);

/// A stream identifier for an **incoming** (receiving) QUIC stream.
/// 
/// Generated by the QUIC implementation.
#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]
pub struct RecvStreamId(pub u64);